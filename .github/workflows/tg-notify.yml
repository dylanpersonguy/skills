name: Telegram Commit Notify
on: [push]
jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send to Telegram
        env:
          TG_BOT_TOKEN: ${{ secrets.TG_BOT_TOKEN }}
          TG_CHAT_ID: ${{ secrets.TG_CHAT_ID }}
        run: |
          COMMIT_MSG=$(cat <<'ENDOFMSG'
          ${{ github.event.head_commit.message }}
          ENDOFMSG
          )
          COMMIT_MSG=$(echo "$COMMIT_MSG" | sed 's/^[[:space:]]*//')

          # English message
          EN_TEXT="ðŸš€ Our Developers just finished implementing new changes, here is a list of the upgrades to our codebase:

          git commit -m \"${COMMIT_MSG}\""

          # Spanish translation of the wrapper
          ES_TEXT="ðŸš€ Nuestros Desarrolladores acaban de terminar de implementar nuevos cambios, aquÃ­ estÃ¡ la lista de las mejoras en nuestro cÃ³digo:

          git commit -m \"${COMMIT_MSG}\""

          # Send English
          curl -s -X POST "https://api.telegram.org/bot${TG_BOT_TOKEN}/sendMessage" \
            -d chat_id="${TG_CHAT_ID}" \
            --data-urlencode "text=${EN_TEXT}"

          # Send Spanish
          curl -s -X POST "https://api.telegram.org/bot${TG_BOT_TOKEN}/sendMessage" \
            -d chat_id="${TG_CHAT_ID}" \
            --data-urlencode "text=${ES_TEXT}"
