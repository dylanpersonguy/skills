name: Telegram Commit Notify
on: [push]
jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send to Telegram
        env:
          TG_BOT_TOKEN: ${{ secrets.TG_BOT_TOKEN }}
          TG_CHAT_ID: ${{ secrets.TG_CHAT_ID }}
        run: |
          REPO="${{ github.repository }}"
          BRANCH="${GITHUB_REF#refs/heads/}"
          ACTOR="${{ github.actor }}"
          HASH="${{ github.sha }}"
          SHORT="${HASH:0:7}"
          MSG=$(echo "${{ github.event.head_commit.message }}" | head -1 | cut -c1-80)
          TEXT="ðŸ“¦ *Push to* \`${REPO}\`
          ðŸŒ¿ Branch: \`${BRANCH}\`
          ðŸ‘¤ ${ACTOR}
          ðŸ”‘ \`${SHORT}\`

          ${MSG}"
          curl -s -X POST "https://api.telegram.org/bot${TG_BOT_TOKEN}/sendMessage" \
            -d chat_id="${TG_CHAT_ID}" \
            -d text="${TEXT}" \
            -d parse_mode="Markdown"